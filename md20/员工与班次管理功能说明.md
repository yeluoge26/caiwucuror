# 员工与班次管理功能说明（轻量版）

## 功能概述

员工与班次管理模块用于管理员工基础档案和排班，支持员工信息管理、班次创建、排班和到岗确认功能。

---

## 一、员工管理功能

### 1. 员工基础档案

**权限要求：** 老板(owner)、店长(manager)、财务(accountant) 可查看，老板和店长可创建/编辑

**功能特点：**
- ✅ 姓名（必填）
- ✅ 角色（关联系统角色表）
- ✅ 联系电话
- ✅ 邮箱
- ✅ 地址
- ✅ 在职/离职状态（active/inactive/resigned）
- ✅ 入职时间
- ✅ 离职时间（可选）
- ✅ 备注

**功能列表：**
- 员工列表（支持分页、筛选、搜索）
- 创建员工
- 编辑员工
- 查看员工详情

---

### 2. 员工列表

**功能特点：**
- 分页显示（每页20条）
- 按状态筛选（在职/离职/已辞职）
- 按角色筛选
- 关键词搜索（姓名、电话、邮箱）
- 显示员工基本信息
- 快速操作（查看、编辑）

---

## 二、班次管理功能

### 1. 班次创建

**权限要求：** 老板(owner)、店长(manager)

**功能特点：**
- ✅ 日期（必填）
- ✅ 班次类型：早班(morning) / 中班(afternoon) / 晚班(evening)
- ✅ 员工（必填，从在职员工中选择）
- ✅ 负责人（可选，从老板/店长中选择）
- ✅ 备注

---

### 2. 排班功能

**权限要求：** 老板(owner)、店长(manager)

**功能特点：**
- ✅ 选择日期进行排班
- ✅ 批量添加班次
- ✅ 动态添加/删除班次行
- ✅ 自动检测并更新已存在的班次
- ✅ 支持同一天同一员工多个班次（早中晚）

**使用流程：**
1. 选择日期
2. 点击"添加班次"按钮
3. 选择班次类型、员工、负责人
4. 可以添加多个班次
5. 提交保存

---

### 3. 班次列表

**功能特点：**
- 分页显示（每页50条）
- 按日期筛选（单日或日期范围）
- 按班次类型筛选
- 按员工筛选
- 按到岗确认状态筛选
- 显示班次详细信息
- 快速确认到岗按钮

---

### 4. 到岗确认

**权限要求：** 老板(owner)、店长(manager)

**功能特点：**
- ✅ 快速确认（在列表中直接点击确认）
- ✅ 取消确认
- ✅ 记录确认时间和确认人
- ✅ 状态标识（已到岗/未确认）

**确认方式：**
1. **快速确认**：在班次列表中直接点击"确认"按钮
2. **详细确认**：点击进入确认页面，填写详细信息

---

## 三、数据库结构

### employees 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| name | VARCHAR(128) | 姓名 |
| role_id | INT | 角色ID（外键） |
| phone | VARCHAR(32) | 联系电话 |
| email | VARCHAR(128) | 邮箱 |
| address | TEXT | 地址 |
| status | ENUM | 状态：active/inactive/resigned |
| hire_date | DATE | 入职时间 |
| resign_date | DATE | 离职时间 |
| note | TEXT | 备注 |
| created_by | INT | 创建人ID |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### shifts 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| shift_date | DATE | 日期 |
| shift_type | ENUM | 班次类型：morning/afternoon/evening |
| employee_id | INT | 员工ID（外键） |
| manager_id | INT | 负责人ID（外键，可选） |
| is_confirmed | TINYINT(1) | 到岗确认：0=未确认，1=已到岗 |
| confirmed_at | DATETIME | 确认时间 |
| confirmed_by | INT | 确认人ID |
| note | TEXT | 备注 |
| created_by | INT | 创建人ID |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

**唯一约束：** `(shift_date, employee_id, shift_type)` - 防止同一员工同一天同一班次重复

---

## 四、路由列表

### 员工管理路由

- `employees/list` - 员工列表
- `employees/create` - 创建员工
- `employees/edit` - 编辑员工
- `employees/view` - 员工详情

### 班次管理路由

- `shifts/list` - 班次列表
- `shifts/create` - 创建班次
- `shifts/schedule` - 排班
- `shifts/confirm` - 确认到岗（详细页面）
- `shifts/quickConfirm` - 快速确认到岗

---

## 五、权限矩阵

| 功能 | Owner | Manager | Accountant | Staff |
|------|-------|---------|------------|-------|
| 查看员工列表 | ✅ | ✅ | ✅ | ❌ |
| 创建员工 | ✅ | ✅ | ❌ | ❌ |
| 编辑员工 | ✅ | ✅ | ❌ | ❌ |
| 查看班次列表 | ✅ | ✅ | ✅ | ❌ |
| 创建班次 | ✅ | ✅ | ❌ | ❌ |
| 排班 | ✅ | ✅ | ❌ | ❌ |
| 确认到岗 | ✅ | ✅ | ❌ | ❌ |

---

## 六、使用示例

### 创建员工示例

1. **新员工入职**
   - 姓名：张三
   - 角色：员工
   - 电话：0123456789
   - 状态：在职
   - 入职时间：2024-12-20

2. **员工离职**
   - 编辑员工信息
   - 状态改为：已辞职
   - 填写离职时间

### 排班示例

1. **单日排班**
   - 选择日期：2024-12-21
   - 添加早班：员工A，负责人：店长
   - 添加中班：员工B，负责人：店长
   - 添加晚班：员工C，负责人：店长

2. **批量排班**
   - 使用排班功能
   - 一次性添加多个班次
   - 系统自动检测重复并更新

### 到岗确认示例

1. **快速确认**
   - 在班次列表中
   - 点击"确认"按钮
   - 系统自动记录确认时间和确认人

2. **批量确认**
   - 筛选未确认的班次
   - 逐个点击确认

---

## 七、技术实现

### 文件结构

```
app/
  models/
    Employee.php          # 员工模型
    Shift.php             # 班次模型
  controllers/
    EmployeeController.php # 员工控制器
    ShiftController.php    # 班次控制器
  views/
    employees/
      list.php           # 员工列表
      create.php         # 创建员工
      edit.php           # 编辑员工
      view.php           # 员工详情
    shifts/
      list.php           # 班次列表
      create.php         # 创建班次
      schedule.php       # 排班
      confirm.php        # 确认到岗
```

### 核心方法

**Employee 模型：**
- `create()` - 创建员工
- `update()` - 更新员工
- `find()` - 查找员工
- `list()` - 员工列表（支持筛选和分页）
- `count()` - 统计员工数量
- `active()` - 获取在职员工

**Shift 模型：**
- `create()` - 创建班次
- `update()` - 更新班次
- `find()` - 查找班次
- `list()` - 班次列表（支持筛选和分页）
- `count()` - 统计班次数量
- `confirm()` - 确认到岗
- `getByDateRange()` - 按日期范围获取班次

---

## 八、注意事项

1. **员工与用户的关系**
   - 员工表（employees）和用户表（users）是独立的
   - 员工是实际的工作人员档案
   - 用户是系统登录账号
   - 未来可以建立关联关系

2. **班次唯一性**
   - 同一员工同一天同一班次只能有一条记录
   - 使用唯一约束防止重复
   - 排班时会自动检测并更新已存在的班次

3. **负责人选择**
   - 负责人从老板和店长角色中选择
   - 负责人也是员工表中的记录
   - 可选字段，可以为空

4. **到岗确认**
   - 只有老板和店长可以确认
   - 确认后记录确认时间和确认人
   - 可以取消确认

---

## 九、未来扩展

1. **员工与用户关联**：建立员工和系统用户的关联关系
2. **班次模板**：创建常用班次模板，快速排班
3. **考勤统计**：统计员工出勤率、迟到早退等
4. **班次提醒**：班次开始前自动提醒
5. **换班申请**：员工可以申请换班
6. **班次统计报表**：按员工、按日期统计班次情况
7. **工资计算**：根据班次和出勤计算工资

---

*最后更新：2024年12月*

