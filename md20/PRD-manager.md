# PRDï½œåº—é•¿ç®¡ç†ç³»ç»Ÿå¢å¼ºç‰ˆï¼ˆV1ï¼‰

## ç›®å½•

1. [èƒŒæ™¯ä¸ç›®æ ‡](#1-èƒŒæ™¯ä¸ç›®æ ‡)
2. [è§’è‰²å®šä¹‰](#2-è§’è‰²å®šä¹‰)
3. [åŠŸèƒ½æ¨¡å—æ¦‚è§ˆï¼ˆV1ï¼‰](#3-åŠŸèƒ½æ¨¡å—æ¦‚è§ˆv1)
4. [æ•°æ®æ¨¡å‹ï¼ˆæ–°å¢è¡¨ï¼‰](#4-æ•°æ®æ¨¡å‹æ–°å¢è¡¨)
5. [åŠŸèƒ½éœ€æ±‚è¯´æ˜](#5-åŠŸèƒ½éœ€æ±‚è¯´æ˜)
6. [UI çº¦æŸä¸é˜²ä½œå¼Šè§„åˆ™](#6-ui-çº¦æŸä¸é˜²ä½œå¼Šè§„åˆ™å…³é”®)
7. [æˆåŠŸæ ‡å‡†ï¼ˆéªŒæ”¶æ ‡å‡†ï¼‰](#7-æˆåŠŸæ ‡å‡†éªŒæ”¶æ ‡å‡†)
8. [éç›®æ ‡ï¼ˆV1 ä¸åšï¼‰](#8-éç›®æ ‡v1-ä¸åš)
9. [ç‰ˆæœ¬è¾¹ç•Œæ€»ç»“](#9-ç‰ˆæœ¬è¾¹ç•Œæ€»ç»“)
10. [å®ç°çŠ¶æ€](#10-å®ç°çŠ¶æ€2024å¹´12æœˆæ›´æ–°)
11. [å¼€å‘ä»»åŠ¡æ¸…å•](#11-å¼€å‘ä»»åŠ¡æ¸…å•)
12. [æŠ€æœ¯å®ç°ç»†èŠ‚](#12-æŠ€æœ¯å®ç°ç»†èŠ‚)
13. [æ•°æ®åº“è¿ç§»è„šæœ¬](#13-æ•°æ®åº“è¿ç§»è„šæœ¬)
14. [æ›´æ–°æ—¥å¿—](#14-æ›´æ–°æ—¥å¿—)

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡
1.1 é¡¹ç›®èƒŒæ™¯

å½“å‰ç³»ç»Ÿå·²å…·å¤‡ï¼š

è´¢åŠ¡æµæ°´ï¼ˆtransactionsï¼‰

æ’ç­ï¼ˆå‘¨æ’ï¼‰

å·¡åº—ä»»åŠ¡

åŸºç¡€ä»»åŠ¡ç³»ç»Ÿ

ç”¨æˆ·è§’è‰²ï¼ˆè€æ¿ / åº—é•¿ï¼‰

ä½†åœ¨çœŸå®é—¨åº—ç®¡ç†åœºæ™¯ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

åº—é•¿æ˜¯å¦çœŸæ­£å·¡åº—ã€æ˜¯å¦è¾¾æ ‡ï¼Œç¼ºä¹å¼ºåˆ¶ä¸å®¡æŸ¥

ç°é‡‘ä¸å¤šæ”¶æ¬¾æ–¹å¼çš„æ—¥ç»ˆäº¤è´¦ç¼ºä¹ç¡®è®¤é—­ç¯

æ’ç­è™½æœ‰ï¼Œä½†å±äºé…ç½®åŠŸèƒ½ï¼Œæœªèå…¥ç®¡ç†ç«¯

é¦–é¡µåâ€œç³»ç»Ÿé¦–é¡µâ€ï¼Œè€Œéâ€œç®¡ç†å¾…åŠâ€

1.2 äº§å“ç›®æ ‡

æœ¬ç‰ˆæœ¬ç›®æ ‡ä¸æ˜¯å¢åŠ å¤æ‚åŠŸèƒ½ï¼Œè€Œæ˜¯ï¼š

é€šè¿‡æœ€å°æ–°å¢è¡¨ + UI çº¦æŸï¼Œ
è®©åº—é•¿æ¯å¤©çš„â€œå…³é”®ç®¡ç†åŠ¨ä½œâ€å¿…é¡»å‘ç”Ÿã€å¯å®¡è®¡ã€å¯è¿½è´£

1.3 æ ¸å¿ƒè®¾è®¡åŸåˆ™

ä¸é‡æ„ç°æœ‰ç³»ç»Ÿ

ä¸é‡å¤ transactions çš„èƒ½åŠ›

ç®¡ç†åŠ¨ä½œå¿…é¡»â€œæœ‰çŠ¶æ€â€

UI é©±åŠ¨è¡Œä¸ºï¼Œè€Œä¸æ˜¯æé†’

åº—é•¿ç«¯åªåšâ€œä»Šå¤©å¿…é¡»å®Œæˆçš„äº‹â€

2. è§’è‰²å®šä¹‰
è§’è‰²	æƒé™è¯´æ˜
åº—é•¿ï¼ˆmanagerï¼‰	å·¡åº—ã€ç°é‡‘æ—¥ç»“ã€é—®é¢˜è®°å½•ã€æ’ç­è°ƒæ•´
è€æ¿ï¼ˆownerï¼‰	å·¡åº—å®¡æ ¸ã€äº¤è´¦å®¡æ ¸ã€æŸ¥çœ‹çŠ¶æ€
è´¢åŠ¡ï¼ˆaccountantï¼‰	äº¤è´¦å®¡æ ¸ï¼ˆå¯é€‰ï¼‰
3. åŠŸèƒ½æ¨¡å—æ¦‚è§ˆï¼ˆV1ï¼‰
æ¨¡å—	æ˜¯å¦æ–°å¢
åº—é•¿é¦–é¡µï¼ˆç®¡ç†æ€ï¼‰	âœ… æ–°
ç°é‡‘æ—¥ç»“ï¼ˆäº¤è´¦ï¼‰	âœ… æ–°
å·¡åº—å¼ºåˆ¶åŒ– + å®¡æ ¸	âš ï¸ è¡¥å¼º
æ’ç­ï¼ˆå‘¨æ’ + è°ƒæ•´ï¼‰	âš ï¸ æ¥å…¥ç®¡ç†ç«¯
é—®é¢˜è®°å½•	âš ï¸ å·²æœ‰ï¼Œæ¥å…¥
4. æ•°æ®æ¨¡å‹ï¼ˆæ–°å¢è¡¨ï¼‰
4.1 cash_closingsï¼ˆå¿…é¡»æ–°å¢ï¼‰
4.1.1 è¡¨èŒè´£

è®°å½•ï¼šæŸä¸€å¤©çš„æ”¶æ¬¾æ˜¯å¦å·²ç”±åº—é•¿äº¤è´¦ï¼Œå¹¶è¢«è€æ¿/è´¢åŠ¡å®¡æ ¸

4.1.2 å­—æ®µå®šä¹‰
å­—æ®µ	ç±»å‹	è¯´æ˜
id	int	ä¸»é”®
date	date	äº¤è´¦æ—¥æœŸ
created_by	int	åº—é•¿
cash_counted	decimal	å®ç›˜ç°é‡‘
cash_note	text	å·®é¢è¯´æ˜
status	enum	draft / submitted / approved / rejected
submitted_at	datetime	æäº¤æ—¶é—´
reviewed_by	int	å®¡æ ¸äºº
reviewed_at	datetime	å®¡æ ¸æ—¶é—´
review_note	text	å®¡æ ¸å¤‡æ³¨

âŒ ä¸å­˜å„æ”¯ä»˜æ–¹å¼é‡‘é¢
âŒ ä¸ç”Ÿæˆæµæ°´

4.2 inspection_reviewsï¼ˆå¦‚ç°æœ‰å·¡åº—æ— å®¡æ ¸å­—æ®µï¼‰

**çŠ¶æ€ï¼šâœ… å·²å®ç°ï¼ˆæ— éœ€æ–°å¢è¡¨ï¼‰**

ç°æœ‰ `inspections` è¡¨å·²åŒ…å«å®¡æ ¸å­—æ®µï¼š
- `reviewed_status` ENUM('pending','confirmed','rejected')
- `review_note` VARCHAR(255)
- `reviewed_by` INT
- `reviewed_at` DATETIME

**è¯´æ˜ï¼š** æ— éœ€æ–°å¢ `inspection_reviews` è¡¨ï¼Œç°æœ‰è¡¨ç»“æ„å·²æ»¡è¶³éœ€æ±‚ã€‚

---

## 10. å®ç°çŠ¶æ€ï¼ˆ2024å¹´12æœˆæ›´æ–°ï¼‰

### 10.1 å·²å®ç°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| å·¡åº—åŠŸèƒ½ | âœ… å·²å®ç° | `inspections` è¡¨å·²å­˜åœ¨ï¼Œæ”¯æŒåˆ›å»ºã€æŸ¥çœ‹ã€å®¡æ ¸ |
| å·¡åº—å®¡æ ¸ | âœ… å·²å®ç° | `InspectionsController::review()` å·²å®ç° |
| æ’ç­åŠŸèƒ½ | âœ… å·²å®ç° | `shifts` è¡¨å·²å­˜åœ¨ï¼Œæ”¯æŒåˆ›å»ºã€åˆ—è¡¨ã€ç¡®è®¤ |
| ä»»åŠ¡ç³»ç»Ÿ | âœ… å·²å®ç° | `tasks` è¡¨å·²å­˜åœ¨ï¼Œæ”¯æŒåˆ›å»ºã€åˆ†é…ã€å®¡æ‰¹ |
| å‘˜å·¥ç®¡ç† | âœ… å·²å®ç° | `employees` è¡¨å·²å­˜åœ¨ï¼Œæ”¯æŒCRUDæ“ä½œ |

### 10.2 å¾…å®ç°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | ä¼˜å…ˆçº§ | çŠ¶æ€ | è¯´æ˜ |
|---------|--------|------|------|
| åº—é•¿é¦–é¡µï¼ˆç®¡ç†æ€ï¼‰ | P0 | â³ å¾…å®ç° | éœ€è¦æ–°å»º `ManagerController::dashboard()` |
| ç°é‡‘æ—¥ç»“ï¼ˆcash_closingsï¼‰ | P0 | â³ å¾…å®ç° | éœ€è¦æ–°å»ºè¡¨å’ŒåŠŸèƒ½ |
| å·¡åº—å¼ºåˆ¶åŒ–è§„åˆ™ | P1 | â³ å¾…è¡¥å¼º | éœ€è¦æ·»åŠ æ¯æ—¥2æ¬¡å¼ºåˆ¶æ£€æŸ¥ã€ç…§ç‰‡å¿…å¡«éªŒè¯ |
| æ’ç­å‘¨æ’åŠŸèƒ½ | P1 | â³ å¾…å¢å¼º | éœ€è¦æ·»åŠ å‘¨æ’è¡¨æ ¼ã€ä¸€é”®å¤åˆ¶ä¸Šå‘¨ã€è‰ç¨¿ä¿å­˜ |
| é—®é¢˜è®°å½•æ¥å…¥ | P2 | â³ å¾…æ¥å…¥ | éœ€è¦å°†ä»»åŠ¡ç³»ç»Ÿæ¥å…¥åº—é•¿é¦–é¡µ |

### 10.3 æ•°æ®åº“è¿ç§»éœ€æ±‚

**éœ€è¦æ–°å¢çš„è¡¨ï¼š**

```sql
-- ç°é‡‘æ—¥ç»“è¡¨
CREATE TABLE IF NOT EXISTS cash_closings (
  id INT AUTO_INCREMENT PRIMARY KEY,
  date DATE NOT NULL COMMENT 'äº¤è´¦æ—¥æœŸ',
  created_by INT NOT NULL COMMENT 'åº—é•¿ID',
  cash_counted DECIMAL(12,2) NOT NULL COMMENT 'å®ç›˜ç°é‡‘',
  cash_note TEXT NULL COMMENT 'å·®é¢è¯´æ˜',
  status ENUM('draft','submitted','approved','rejected') NOT NULL DEFAULT 'draft' COMMENT 'çŠ¶æ€',
  submitted_at DATETIME NULL COMMENT 'æäº¤æ—¶é—´',
  reviewed_by INT NULL COMMENT 'å®¡æ ¸äººID',
  reviewed_at DATETIME NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  review_note TEXT NULL COMMENT 'å®¡æ ¸å¤‡æ³¨',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  CONSTRAINT fk_cash_closing_creator FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
  CONSTRAINT fk_cash_closing_reviewer FOREIGN KEY (reviewed_by) REFERENCES users(id) ON DELETE SET NULL,
  UNIQUE KEY uk_cash_closing_date (date),
  INDEX idx_cash_closing_status (status),
  INDEX idx_cash_closing_date (date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç°é‡‘æ—¥ç»“è¡¨';
```

**éœ€è¦å¢å¼ºçš„åŠŸèƒ½ï¼š**

1. **inspections è¡¨å¢å¼º**ï¼ˆå¯é€‰ï¼Œå½“å‰å·²æ»¡è¶³åŸºæœ¬éœ€æ±‚ï¼‰
   - å·²æœ‰ `reviewed_status` å­—æ®µï¼Œæ”¯æŒå®¡æ ¸
   - éœ€è¦æ·»åŠ ï¼šç…§ç‰‡å¿…å¡«éªŒè¯ã€æ¯æ—¥2æ¬¡å¼ºåˆ¶æ£€æŸ¥é€»è¾‘

2. **shifts è¡¨å¢å¼º**ï¼ˆå¯é€‰ï¼Œå½“å‰å·²æ»¡è¶³åŸºæœ¬éœ€æ±‚ï¼‰
   - å·²æœ‰åŸºç¡€æ’ç­åŠŸèƒ½
   - éœ€è¦æ·»åŠ ï¼šå‘¨æ’è¡¨æ ¼è§†å›¾ã€è‰ç¨¿ä¿å­˜ã€å‘å¸ƒçŠ¶æ€

---

## 11. å¼€å‘ä»»åŠ¡æ¸…å•

### 11.1 æ•°æ®åº“è¿ç§»

- [ ] åˆ›å»º `cash_closings` è¡¨è¿ç§»è„šæœ¬
- [ ] æµ‹è¯•è¿ç§»è„šæœ¬

### 11.2 ç°é‡‘æ—¥ç»“åŠŸèƒ½

- [ ] åˆ›å»º `CashClosing` æ¨¡å‹ (`app/models/CashClosing.php`)
- [ ] åˆ›å»º `CashClosingController` (`app/controllers/CashClosingController.php`)
- [ ] å®ç°åº—é•¿ç«¯ï¼šç°é‡‘æ—¥ç»“å¡«å†™é¡µé¢ (`app/views/cash_closings/create.php`)
- [ ] å®ç°åº—é•¿ç«¯ï¼šç°é‡‘æ—¥ç»“åˆ—è¡¨é¡µé¢ (`app/views/cash_closings/list.php`)
- [ ] å®ç°å®¡æ ¸ç«¯ï¼šäº¤è´¦å®¡æ ¸é¡µé¢ (`app/views/cash_closings/review.php`)
- [ ] æ·»åŠ è·¯ç”±ï¼š`cash_closings/create`, `cash_closings/list`, `cash_closings/review`
- [ ] å®ç°ç°é‡‘è®¡ç®—é€»è¾‘ï¼ˆä» transactions è¡¨ç»Ÿè®¡ç°é‡‘æ”¶å…¥/æ”¯å‡ºï¼‰

### 11.3 åº—é•¿é¦–é¡µï¼ˆç®¡ç†æ€ï¼‰

- [ ] åˆ›å»º `ManagerController` (`app/controllers/ManagerController.php`)
- [ ] å®ç° `ManagerController::dashboard()` æ–¹æ³•
- [ ] åˆ›å»ºåº—é•¿é¦–é¡µè§†å›¾ (`app/views/manager/dashboard.php`)
- [ ] å®ç°ä»Šæ—¥å·¡åº—çŠ¶æ€å¡ç‰‡ï¼ˆç»Ÿè®¡ä»Šæ—¥å·²å®¡æ ¸å·¡åº—æ¬¡æ•°ï¼‰
- [ ] å®ç°ä»Šæ—¥ç°é‡‘æ—¥ç»“çŠ¶æ€å¡ç‰‡
- [ ] å®ç°ä»Šæ—¥ä»»åŠ¡å¡ç‰‡ï¼ˆä» tasks è¡¨è·å–ï¼‰
- [ ] å®ç°æœ¬å‘¨æ’ç­å¡ç‰‡ï¼ˆä» shifts è¡¨è·å–ï¼‰
- [ ] æ·»åŠ è·¯ç”±ï¼š`manager/dashboard`
- [ ] æ›´æ–°å¯¼èˆªèœå•ï¼Œåº—é•¿è§’è‰²é»˜è®¤è·³è½¬åˆ°åº—é•¿é¦–é¡µ

### 11.4 å·¡åº—åŠŸèƒ½è¡¥å¼º

- [ ] åœ¨ `InspectionsController::create()` ä¸­æ·»åŠ ç…§ç‰‡å¿…å¡«éªŒè¯
- [ ] æ·»åŠ æ¯æ—¥2æ¬¡å·¡åº—å¼ºåˆ¶æ£€æŸ¥é€»è¾‘
- [ ] ç¦æ­¢å›å¡«å†å²å·¡åº—ï¼ˆspot_date ä¸èƒ½æ˜¯è¿‡å»æ—¥æœŸï¼‰
- [ ] æ›´æ–°å·¡åº—åˆ›å»ºé¡µé¢ï¼Œæ·»åŠ ç…§ç‰‡å¿…å¡«æç¤º

### 11.5 æ’ç­åŠŸèƒ½å¢å¼º

- [ ] åˆ›å»ºå‘¨æ’é¡µé¢ (`app/views/shifts/weekly_schedule.php`)
- [ ] å®ç°å‘˜å·¥ Ã— å‘¨ä¸€åˆ°å‘¨æ—¥çš„è¡¨æ ¼è§†å›¾
- [ ] å®ç°å•å…ƒæ ¼ç‚¹å‡»å¾ªç¯ï¼šä¼‘ â†’ æ—© â†’ æ™š â†’ ä¼‘
- [ ] å®ç°ä¸€é”®å¤åˆ¶ä¸Šå‘¨åŠŸèƒ½
- [ ] å®ç°è‰ç¨¿ä¿å­˜åŠŸèƒ½
- [ ] å®ç°å‘å¸ƒæœ¬å‘¨æ’ç­åŠŸèƒ½
- [ ] æ·»åŠ å‘å¸ƒçŠ¶æ€å­—æ®µåˆ° `shifts` è¡¨ï¼ˆå¯é€‰ï¼Œæˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼æ ‡è®°ï¼‰

### 11.6 å›½é™…åŒ–

- [ ] æ·»åŠ ç°é‡‘æ—¥ç»“ç›¸å…³ç¿»è¯‘ï¼ˆ`lang/zh.php`, `lang/vi.php`ï¼‰
- [ ] æ·»åŠ åº—é•¿é¦–é¡µç›¸å…³ç¿»è¯‘
- [ ] æ·»åŠ æ’ç­å‘¨æ’ç›¸å…³ç¿»è¯‘

### 11.7 æµ‹è¯•

- [ ] æµ‹è¯•ç°é‡‘æ—¥ç»“åˆ›å»ºæµç¨‹
- [ ] æµ‹è¯•ç°é‡‘æ—¥ç»“å®¡æ ¸æµç¨‹
- [ ] æµ‹è¯•åº—é•¿é¦–é¡µå„å¡ç‰‡çŠ¶æ€æ˜¾ç¤º
- [ ] æµ‹è¯•å·¡åº—å¼ºåˆ¶åŒ–è§„åˆ™
- [ ] æµ‹è¯•æ’ç­å‘¨æ’åŠŸèƒ½

---

5. åŠŸèƒ½éœ€æ±‚è¯´æ˜
5.1 åº—é•¿é¦–é¡µï¼ˆæ ¸å¿ƒï¼‰
5.1.1 è®¾è®¡ç›®æ ‡

é¦–é¡µ = ä»Šæ—¥ç®¡ç†æ¸…å•
æ‰€æœ‰å¡ç‰‡éƒ½å¿…é¡»â€œèƒ½ç‚¹è¿›å»åšäº‹â€

5.1.2 é¡µé¢ç»“æ„ï¼ˆå®šç‰ˆï¼‰

ä»Šæ—¥ä¿¡æ¯

ä»Šæ—¥æ‰§è¡Œï¼ˆä»»åŠ¡ï¼‰

ğŸ” ä»Šæ—¥å·¡åº—ï¼ˆå¼ºåˆ¶ï¼‰

ğŸ’¸ ä»Šæ—¥ç°é‡‘ï¼ˆæ—¥ç»“ï¼‰

âš  ä»Šæ—¥é—®é¢˜

ğŸ‘¥ æœ¬å‘¨æ’ç­ï¼ˆå‘¨ç»´åº¦ï¼‰

5.1.3 çŠ¶æ€é©±åŠ¨è§„åˆ™
å·¡åº—å¡
æ¡ä»¶	çŠ¶æ€
0 æ¬¡æœ‰æ•ˆå·¡åº—	ğŸ”´
1 æ¬¡	ğŸŸ¡
â‰¥2 æ¬¡	ğŸŸ¢
ç°é‡‘å¡
æ¡ä»¶	çŠ¶æ€
æœªäº¤è´¦	ğŸ”´
å·²äº¤è´¦æœªå®¡	ğŸŸ¡
å·®é¢æ— è¯´æ˜	ğŸŸ 
å·²å®¡æ ¸	ğŸŸ¢
5.2 å·¡åº—ç®¡ç†ï¼ˆè¡¥å¼ºï¼‰
5.2.1 å·¡åº—è§„åˆ™

æ¯å¤© è‡³å°‘ 2 æ¬¡

æ¯æ¬¡å¿…é¡»ï¼š

æ‹ç…§ï¼ˆç°åœºï¼‰

æäº¤æŠ¥å‘Š

åªæœ‰å®¡æ ¸é€šè¿‡çš„å·¡åº—æ‰è®¡æ•°

5.2.2 å·¡åº—å¡«å†™é¡µï¼ˆåº—é•¿ç«¯ï¼‰

å¿…å¡«ï¼šç…§ç‰‡ â‰¥1

å¯é€‰ï¼šè¯´æ˜

å¯é€‰ï¼šå…³è”é—®é¢˜ï¼ˆå¼‚å¸¸ / è´§æŸ / é”™åšï¼‰

ä¸å…è®¸å›å¡« / ä¿®æ”¹

5.2.3 å·¡åº—å®¡æ ¸é¡µï¼ˆè€æ¿ç«¯ï¼‰

æŸ¥çœ‹ï¼šç…§ç‰‡ + è¯´æ˜

æ“ä½œï¼šé€šè¿‡ / é©³å›ï¼ˆå¿…å¡«åŸå› ï¼‰

é©³å›ä¸è®¡å…¥å½“æ—¥æ¬¡æ•°

5.3 ç°é‡‘æ—¥ç»“ï¼ˆæ–°å¢æ ¸å¿ƒæ¨¡å—ï¼‰
5.3.1 åº—é•¿ç«¯ï¼šç°é‡‘æ—¥ç»“å¡«å†™
å¿…å¡«é¡¹

å®ç›˜ç°é‡‘

ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—

ç°é‡‘æ”¶å…¥åˆè®¡

ç°é‡‘æ”¯å‡ºåˆè®¡

ç†è®ºç°é‡‘ä½™é¢

å·®é¢

è§„åˆ™

å·®é¢ â‰  0 â†’ å¿…é¡»å¡«å†™è¯´æ˜

ä¸€å¤©åªèƒ½æäº¤ä¸€æ¬¡

5.3.2 å®¡æ ¸ç«¯ï¼šäº¤è´¦å®¡æ ¸é¡µ
å±•ç¤ºå†…å®¹

ç°é‡‘å¯¹è´¦ï¼ˆç†è®º vs å®ç›˜ï¼‰

å„æ”¶æ¬¾æ–¹å¼æµæ°´æ±‡æ€»ï¼ˆåªè¯»ï¼‰

ç³»ç»Ÿå¼‚å¸¸æç¤º

æ“ä½œ

é€šè¿‡

é©³å›ï¼ˆå¿…å¡«åŸå› ï¼‰

5.4 æ’ç­ï¼ˆå‘¨æ’ + è°ƒæ•´ï¼‰
5.4.1 æ’ç­èŠ‚å¥

å‘¨æ’ï¼šæ¯å‘¨ä¸€æ¬¡

æ—¥å¸¸åªå…è®¸ï¼š

è°ƒç­

è°ƒä¼‘

ä¸´æ—¶åŠ ç­

5.4.2 å‘¨æ’é¡µé¢è§„åˆ™

è¡¨æ ¼ï¼šå‘˜å·¥ Ã— å‘¨ä¸€è‡³å‘¨æ—¥

å•å…ƒæ ¼ç‚¹å‡»å¾ªç¯ï¼š

ä¼‘ â†’ æ—© â†’ æ™š â†’ ä¼‘


æ”¯æŒï¼š

ä¸€é”®å¤åˆ¶ä¸Šå‘¨

è‰ç¨¿ä¿å­˜

å‘å¸ƒæœ¬å‘¨æ’ç­

5.4.3 å‘å¸ƒåçº¦æŸ

å‘å¸ƒåç¦æ­¢ç›´æ¥ä¿®æ”¹

æ‰€æœ‰å˜æ›´å¿…é¡»é€šè¿‡ã€Œæ’ç­è°ƒæ•´ã€

5.5 é—®é¢˜è®°å½•ï¼ˆå·²æœ‰ï¼Œæ¥å…¥ï¼‰
é—®é¢˜ç±»å‹

å¼‚å¸¸

è´§æŸ

é”™åš

æ¥æº

å·¡åº—ä¸­å¿«é€Ÿè®°å½•

ç®¡ç†ç«¯æ‰‹åŠ¨è®°å½•

6. UI çº¦æŸä¸é˜²ä½œå¼Šè§„åˆ™ï¼ˆå…³é”®ï¼‰
è¡Œä¸º	æ˜¯å¦å…è®¸
æ— ç…§ç‰‡æäº¤å·¡åº—	âŒ
å›å¡«å†å²å·¡åº—	âŒ
å·®é¢æ— è¯´æ˜äº¤è´¦	âŒ
å‘å¸ƒåç›´æ¥æ”¹æ’ç­	âŒ
ä¿®æ”¹å·²å®¡æ ¸æ—¥ç»“	âŒ
7. æˆåŠŸæ ‡å‡†ï¼ˆéªŒæ”¶æ ‡å‡†ï¼‰
åº—é•¿ç«¯

æ¯å¤©ä¸‹ç­å‰ï¼š

å·¡åº— â‰¥2ï¼ˆå·²å®¡ï¼‰

ç°é‡‘çŠ¶æ€ä¸º ğŸŸ¢

è€æ¿ç«¯

ä¸è¿½é—®ï¼š

ä»Šå¤©æœ‰æ²¡æœ‰å·¡åº—

é’±æœ‰æ²¡æœ‰å¯¹æ¸…

8. éç›®æ ‡ï¼ˆV1 ä¸åšï¼‰

å‘˜å·¥ç«¯ App

è‡ªåŠ¨ç»©æ•ˆè¯„åˆ†

å¤šé—¨åº—æ¨ªå‘å¯¹æ¯”

è´¢åŠ¡æœˆæŠ¥ / å¹´æŠ¥

9. ç‰ˆæœ¬è¾¹ç•Œæ€»ç»“

è¿™æ˜¯ä¸€ä¸ª"æŠŠç³»ç»Ÿå˜æˆç®¡ç†å·¥å…·"çš„ç‰ˆæœ¬
ä¸æ˜¯ä¸€ä¸ª"åŠ åŠŸèƒ½"çš„ç‰ˆæœ¬ã€‚

---

## 12. æŠ€æœ¯å®ç°ç»†èŠ‚

### 12.1 ç°é‡‘æ—¥ç»“è®¡ç®—é€»è¾‘

**ç†è®ºç°é‡‘ä½™é¢è®¡ç®—ï¼š**

```php
// è·å–æŒ‡å®šæ—¥æœŸçš„ç°é‡‘äº¤æ˜“
$cashIncome = Transaction::getSummary([
    'from' => $date . ' 00:00:00',
    'to' => $date . ' 23:59:59',
    'payment_method' => 'cash', // ç°é‡‘æ”¯ä»˜æ–¹å¼ID
    'type' => 'income',
    'status' => 'approved'
]);

$cashExpense = Transaction::getSummary([
    'from' => $date . ' 00:00:00',
    'to' => $date . ' 23:59:59',
    'payment_method' => 'cash',
    'type' => 'expense',
    'status' => 'approved'
]);

// ç†è®ºç°é‡‘ä½™é¢ = æœŸåˆç°é‡‘ + ç°é‡‘æ”¶å…¥ - ç°é‡‘æ”¯å‡º
// æœŸåˆç°é‡‘éœ€è¦ä»ä¸Šä¸€æ—¥çš„æ—¥ç»“è®°å½•ä¸­è·å–
$theoreticalBalance = $openingCash + $cashIncome - $cashExpense;
```

**å·®é¢è®¡ç®—ï¼š**

```php
$difference = $cashCounted - $theoreticalBalance;
```

### 12.2 åº—é•¿é¦–é¡µçŠ¶æ€è®¡ç®—

**ä»Šæ—¥å·¡åº—çŠ¶æ€ï¼š**

```php
// ç»Ÿè®¡ä»Šæ—¥å·²å®¡æ ¸é€šè¿‡çš„å·¡åº—æ¬¡æ•°
$todayInspections = Inspection::list([
    'spot_date' => date('Y-m-d'),
    'reviewed_status' => 'confirmed'
]);

$inspectionCount = count($todayInspections);
$inspectionStatus = 'red'; // ğŸ”´
if ($inspectionCount >= 2) {
    $inspectionStatus = 'green'; // ğŸŸ¢
} elseif ($inspectionCount == 1) {
    $inspectionStatus = 'yellow'; // ğŸŸ¡
}
```

**ä»Šæ—¥ç°é‡‘æ—¥ç»“çŠ¶æ€ï¼š**

```php
$todayClosing = CashClosing::findByDate(date('Y-m-d'));
$cashStatus = 'red'; // ğŸ”´ æœªäº¤è´¦

if ($todayClosing) {
    if ($todayClosing['status'] === 'approved') {
        $cashStatus = 'green'; // ğŸŸ¢ å·²å®¡æ ¸
    } elseif ($todayClosing['status'] === 'submitted') {
        // æ£€æŸ¥æ˜¯å¦æœ‰å·®é¢ä¸”æ— è¯´æ˜
        if ($todayClosing['difference'] != 0 && empty($todayClosing['cash_note'])) {
            $cashStatus = 'orange'; // ğŸŸ  å·®é¢æ— è¯´æ˜
        } else {
            $cashStatus = 'yellow'; // ğŸŸ¡ å·²äº¤è´¦æœªå®¡
        }
    }
}
```

### 12.3 è·¯ç”±é…ç½®

éœ€è¦åœ¨ `public/index.php` æˆ–è·¯ç”±é…ç½®ä¸­æ·»åŠ ï¼š

```php
// åº—é•¿é¦–é¡µ
'manager/dashboard' => 'ManagerController::dashboard',

// ç°é‡‘æ—¥ç»“
'cash_closings/create' => 'CashClosingController::create',
'cash_closings/list' => 'CashClosingController::list',
'cash_closings/view' => 'CashClosingController::view',
'cash_closings/review' => 'CashClosingController::review',

// æ’ç­å‘¨æ’ï¼ˆå¢å¼ºï¼‰
'shifts/weekly' => 'ShiftController::weeklySchedule',
```

### 12.4 æƒé™æ§åˆ¶

**åº—é•¿é¦–é¡µï¼š**
- ä»…åº—é•¿ï¼ˆmanagerï¼‰è§’è‰²å¯è®¿é—®
- è€æ¿ï¼ˆownerï¼‰å¯æŸ¥çœ‹ä½†ä½¿ç”¨ä¸åŒè§†å›¾

**ç°é‡‘æ—¥ç»“ï¼š**
- åˆ›å»º/æäº¤ï¼šåº—é•¿ï¼ˆmanagerï¼‰
- å®¡æ ¸ï¼šè€æ¿ï¼ˆownerï¼‰ã€è´¢åŠ¡ï¼ˆaccountantï¼‰

**å·¡åº—å¼ºåˆ¶åŒ–ï¼š**
- åˆ›å»ºï¼šåº—é•¿ï¼ˆmanagerï¼‰ã€è€æ¿ï¼ˆownerï¼‰
- å®¡æ ¸ï¼šè€æ¿ï¼ˆownerï¼‰ã€åº—é•¿ï¼ˆmanagerï¼‰ã€è´¢åŠ¡ï¼ˆaccountantï¼‰

---

## 13. æ•°æ®åº“è¿ç§»è„šæœ¬

åˆ›å»ºæ–‡ä»¶ï¼š`database/add_cash_closings_table.sql`

```sql
-- ç°é‡‘æ—¥ç»“è¡¨
CREATE TABLE IF NOT EXISTS cash_closings (
  id INT AUTO_INCREMENT PRIMARY KEY,
  date DATE NOT NULL COMMENT 'äº¤è´¦æ—¥æœŸ',
  created_by INT NOT NULL COMMENT 'åº—é•¿ID',
  cash_counted DECIMAL(12,2) NOT NULL COMMENT 'å®ç›˜ç°é‡‘',
  cash_note TEXT NULL COMMENT 'å·®é¢è¯´æ˜',
  status ENUM('draft','submitted','approved','rejected') NOT NULL DEFAULT 'draft' COMMENT 'çŠ¶æ€',
  submitted_at DATETIME NULL COMMENT 'æäº¤æ—¶é—´',
  reviewed_by INT NULL COMMENT 'å®¡æ ¸äººID',
  reviewed_at DATETIME NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  review_note TEXT NULL COMMENT 'å®¡æ ¸å¤‡æ³¨',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  CONSTRAINT fk_cash_closing_creator FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
  CONSTRAINT fk_cash_closing_reviewer FOREIGN KEY (reviewed_by) REFERENCES users(id) ON DELETE SET NULL,
  UNIQUE KEY uk_cash_closing_date (date),
  INDEX idx_cash_closing_status (status),
  INDEX idx_cash_closing_date (date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç°é‡‘æ—¥ç»“è¡¨';
```

---

## 14. æ›´æ–°æ—¥å¿—

### 2024å¹´12æœˆ - æ–‡æ¡£æ›´æ–°

- âœ… æ·»åŠ å®ç°çŠ¶æ€ç« èŠ‚
- âœ… ç¡®è®¤ `inspection_reviews` è¡¨æ— éœ€æ–°å¢ï¼ˆç°æœ‰è¡¨å·²æ»¡è¶³ï¼‰
- âœ… æ·»åŠ æ•°æ®åº“è¿ç§»è„šæœ¬
- âœ… æ·»åŠ å¼€å‘ä»»åŠ¡æ¸…å•
- âœ… æ·»åŠ æŠ€æœ¯å®ç°ç»†èŠ‚
- âœ… æ·»åŠ ä»£ç ç¤ºä¾‹

### å¾…å®ç°åŠŸèƒ½

- â³ åº—é•¿é¦–é¡µï¼ˆç®¡ç†æ€ï¼‰
- â³ ç°é‡‘æ—¥ç»“åŠŸèƒ½
- â³ å·¡åº—å¼ºåˆ¶åŒ–è¡¥å¼º
- â³ æ’ç­å‘¨æ’å¢å¼º