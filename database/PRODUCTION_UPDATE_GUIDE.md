# ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“æ›´æ–°æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ç”¨äºæ›´æ–°ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ï¼Œæ·»åŠ ç¼ºå¤±çš„è¡¨å’Œå­—æ®µã€‚

## ğŸ” æ£€æŸ¥ç»“æœ

### ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ç°çŠ¶

**å·²å­˜åœ¨çš„è¡¨ï¼ˆ19ä¸ªï¼‰ï¼š**
- âœ“ rolesï¼ˆè§’è‰²è¡¨ï¼‰
- âœ“ usersï¼ˆç”¨æˆ·è¡¨ï¼‰
- âœ“ categoriesï¼ˆåˆ†ç±»è¡¨ï¼‰
- âœ“ payment_methodsï¼ˆæ”¯ä»˜æ–¹å¼è¡¨ï¼‰
- âœ“ vendorsï¼ˆä¾›åº”å•†è¡¨ï¼‰
- âœ“ transactionsï¼ˆäº¤æ˜“è¡¨ï¼‰
- âœ“ attachmentsï¼ˆäº¤æ˜“é™„ä»¶è¡¨ï¼‰
- âœ“ void_requestsï¼ˆä½œåºŸç”³è¯·è¡¨ï¼‰
- âœ“ assetsï¼ˆå›ºå®šèµ„äº§è¡¨ï¼‰
- âœ“ asset_attachmentsï¼ˆå›ºå®šèµ„äº§å›¾ç‰‡è¡¨ï¼‰
- âœ“ materialsï¼ˆåŸæ–™åº“å­˜è¡¨ï¼‰
- âœ“ material_attachmentsï¼ˆåŸæ–™é™„ä»¶è¡¨ï¼‰
- âœ“ drinksï¼ˆé¥®å“è¡¨ï¼‰
- âœ“ drink_recipesï¼ˆé¥®å“é…æ–¹è¡¨ï¼‰
- âœ“ consumption_logsï¼ˆè€—ææ¶ˆè€—è®°å½•è¡¨ï¼‰
- âœ“ inspectionsï¼ˆå·¡åº—è®°å½•è¡¨ï¼‰
- âœ“ inspection_photosï¼ˆå·¡åº—ç…§ç‰‡è¡¨ï¼‰
- âœ“ tasksï¼ˆä»»åŠ¡è¡¨ï¼‰
- âœ“ task_attachmentsï¼ˆä»»åŠ¡é™„ä»¶è¡¨ï¼‰
- âœ“ employeesï¼ˆå‘˜å·¥è¡¨ï¼‰
- âœ“ shiftsï¼ˆç­æ¬¡è¡¨ï¼‰

**ç¼ºå¤±çš„è¡¨ï¼ˆ1ä¸ªï¼‰ï¼š**
- âœ— **cash_closings**ï¼ˆç°é‡‘æ—¥ç»“è¡¨ï¼‰

**ç¼ºå¤±çš„å­—æ®µï¼š**
- âœ— **employees.employment_type**ï¼ˆé›‡ä½£ç±»å‹å­—æ®µï¼‰
- âœ— **shifts.status**ï¼ˆåœ¨å²—çŠ¶æ€å­—æ®µï¼‰

## ğŸš€ æ›´æ–°æ­¥éª¤

### 1. å¤‡ä»½æ•°æ®åº“ï¼ˆé‡è¦ï¼ï¼‰

```bash
# ä½¿ç”¨ mysqldump å¤‡ä»½
mysqldump -u root -p tech_cafemanager > backup_$(date +%Y%m%d_%H%M%S).sql

# æˆ–ä½¿ç”¨ phpMyAdmin å¯¼å‡ºåŠŸèƒ½
```

### 2. æ‰§è¡Œæ›´æ–°è„šæœ¬

#### æ–¹å¼1ï¼šä½¿ç”¨ MySQL å‘½ä»¤è¡Œ

```bash
mysql -u root -p tech_cafemanager < database/update_production_database.sql
```

#### æ–¹å¼2ï¼šä½¿ç”¨ phpMyAdmin

1. ç™»å½• phpMyAdmin
2. é€‰æ‹© `tech_cafemanager` æ•°æ®åº“
3. ç‚¹å‡»"SQL"æ ‡ç­¾
4. å¤åˆ¶ `update_production_database.sql` çš„å†…å®¹
5. ç²˜è´´åˆ° SQL ç¼–è¾‘æ¡†
6. ç‚¹å‡»"æ‰§è¡Œ"

#### æ–¹å¼3ï¼šä½¿ç”¨ MySQL Workbench

1. æ‰“å¼€ MySQL Workbench
2. è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨
3. æ‰“å¼€ `update_production_database.sql` æ–‡ä»¶
4. æ‰§è¡Œè„šæœ¬

### 3. éªŒè¯æ›´æ–°ç»“æœ

æ‰§è¡Œè„šæœ¬åï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ˜¾ç¤ºéªŒè¯ç»“æœã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨éªŒè¯ï¼š

```sql
-- æ£€æŸ¥ cash_closings è¡¨æ˜¯å¦å­˜åœ¨
SHOW TABLES LIKE 'cash_closings';

-- æ£€æŸ¥ employees è¡¨çš„å­—æ®µ
SHOW COLUMNS FROM employees LIKE 'employment_type';

-- æ£€æŸ¥ shifts è¡¨çš„å­—æ®µ
SHOW COLUMNS FROM shifts LIKE 'status';

-- æ£€æŸ¥ shifts è¡¨çš„ç´¢å¼•
SHOW INDEX FROM shifts WHERE Key_name = 'idx_shifts_status';
```

## ğŸ“ æ›´æ–°å†…å®¹è¯¦æƒ…

### 1. æ–°å¢è¡¨ï¼šcash_closingsï¼ˆç°é‡‘æ—¥ç»“è¡¨ï¼‰

**ç”¨é€”ï¼š** ç”¨äºåº—é•¿æäº¤æ¯æ—¥ç°é‡‘ç›˜ç‚¹è®°å½•

**å­—æ®µè¯´æ˜ï¼š**
- `id` - ä¸»é”®
- `date` - äº¤è´¦æ—¥æœŸï¼ˆå”¯ä¸€ï¼‰
- `created_by` - åº—é•¿ID
- `cash_counted` - å®ç›˜ç°é‡‘
- `cash_note` - å·®é¢è¯´æ˜
- `status` - çŠ¶æ€ï¼ˆdraft/submitted/approved/rejectedï¼‰
- `submitted_at` - æäº¤æ—¶é—´
- `reviewed_by` - å®¡æ ¸äººID
- `reviewed_at` - å®¡æ ¸æ—¶é—´
- `review_note` - å®¡æ ¸å¤‡æ³¨
- `created_at` - åˆ›å»ºæ—¶é—´
- `updated_at` - æ›´æ–°æ—¶é—´

### 2. æ–°å¢å­—æ®µï¼šemployees.employment_type

**ç”¨é€”ï¼š** åŒºåˆ†å…¨èŒå’Œå…¼èŒå‘˜å·¥

**ç±»å‹ï¼š** ENUM('full_time', 'part_time')
**é»˜è®¤å€¼ï¼š** 'full_time'
**ä½ç½®ï¼š** åœ¨ `status` å­—æ®µä¹‹å

### 3. æ–°å¢å­—æ®µï¼šshifts.status

**ç”¨é€”ï¼š** è®°å½•å‘˜å·¥åœ¨å²—çŠ¶æ€

**ç±»å‹ï¼š** ENUM('pending', 'confirmed', 'late', 'leave', 'off', 'abnormal')
**é»˜è®¤å€¼ï¼š** 'pending'
**ä½ç½®ï¼š** åœ¨ `is_confirmed` å­—æ®µä¹‹å

**çŠ¶æ€è¯´æ˜ï¼š**
- `pending` - æœªç¡®è®¤
- `confirmed` - å·²åˆ°å²—
- `late` - è¿Ÿåˆ°
- `leave` - è¯·å‡
- `off` - è°ƒä¼‘
- `abnormal` - æ‰“å¡å¼‚å¸¸

**æ•°æ®è¿ç§»ï¼š** è„šæœ¬ä¼šè‡ªåŠ¨å°†ç°æœ‰çš„ `is_confirmed=1` çš„è®°å½•è¿ç§»ä¸º `status='confirmed'`

### 4. æ–°å¢ç´¢å¼•ï¼šidx_shifts_status

**ç”¨é€”ï¼š** æé«˜æŒ‰çŠ¶æ€æŸ¥è¯¢ç­æ¬¡çš„æ€§èƒ½

## âœ… æ›´æ–°åéªŒè¯æ¸…å•

- [ ] `cash_closings` è¡¨å·²åˆ›å»º
- [ ] `employees.employment_type` å­—æ®µå·²æ·»åŠ 
- [ ] `shifts.status` å­—æ®µå·²æ·»åŠ 
- [ ] `shifts` è¡¨çš„æ•°æ®å·²æ­£ç¡®è¿ç§»
- [ ] `idx_shifts_status` ç´¢å¼•å·²åˆ›å»º
- [ ] æ‰€æœ‰å¤–é”®çº¦æŸæ­£å¸¸
- [ ] åº”ç”¨ç¨‹åºåŠŸèƒ½æ­£å¸¸

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¤‡ä»½æ¢å¤ï¼š

```bash
# æ¢å¤å¤‡ä»½
mysql -u root -p tech_cafemanager < backup_YYYYMMDD_HHMMSS.sql
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½ä¼˜å…ˆ**ï¼šæ‰§è¡Œæ›´æ–°å‰åŠ¡å¿…å¤‡ä»½æ•°æ®åº“
2. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œï¼ŒéªŒè¯æ— è¯¯åå†æ›´æ–°ç”Ÿäº§ç¯å¢ƒ
3. **æ•°æ®è¿ç§»**ï¼š`shifts.status` å­—æ®µçš„æ•°æ®ä¼šè‡ªåŠ¨ä» `is_confirmed` è¿ç§»
4. **å…¼å®¹æ€§**ï¼šæ›´æ–°è„šæœ¬ä½¿ç”¨ `IF NOT EXISTS` å’Œæ¡ä»¶æ£€æŸ¥ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œ
5. **å¤–é”®çº¦æŸ**ï¼šç¡®ä¿æ‰€æœ‰å¤–é”®å¼•ç”¨çš„è¡¨å’Œæ•°æ®éƒ½å­˜åœ¨

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚æœå­—æ®µå·²å­˜åœ¨ä¼šæ€æ ·ï¼Ÿ
A: è„šæœ¬ä¼šæ£€æµ‹å­—æ®µæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™è·³è¿‡ï¼Œä¸ä¼šæŠ¥é”™ã€‚

### Q: å¯ä»¥é‡å¤æ‰§è¡Œè„šæœ¬å—ï¼Ÿ
A: å¯ä»¥ã€‚è„šæœ¬ä½¿ç”¨äº†æ¡ä»¶æ£€æŸ¥ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œã€‚

### Q: æ›´æ–°ä¼šå½±å“ç°æœ‰æ•°æ®å—ï¼Ÿ
A: ä¸ä¼šã€‚æ›´æ–°è„šæœ¬åªæ·»åŠ æ–°è¡¨å’Œå­—æ®µï¼Œä¸ä¼šä¿®æ”¹æˆ–åˆ é™¤ç°æœ‰æ•°æ®ã€‚

### Q: å¦‚ä½•ç¡®è®¤æ›´æ–°æˆåŠŸï¼Ÿ
A: æ‰§è¡Œè„šæœ¬åï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ˜¾ç¤ºéªŒè¯ç»“æœã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡ŒéªŒè¯SQLã€‚



