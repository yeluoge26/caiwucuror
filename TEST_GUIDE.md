# 测试指南

## 快速测试步骤

### 1. 通过浏览器测试（推荐）

#### 步骤1: 运行系统测试
在浏览器中访问：
```
http://localhost/public/test.php
```

这个测试页面会检查：
- ✅ PHP版本和扩展
- ✅ 文件结构完整性
- ✅ 数据库配置
- ✅ 数据库连接
- ✅ 数据表是否存在
- ✅ Session功能
- ✅ 路由和控制器
- ✅ 语言包

#### 步骤2: 初始化数据库（如果需要）
如果测试显示数据库表不存在，访问：
```
http://localhost/init_db.php
```

点击"初始化数据库"按钮，系统会自动：
- 创建所有数据表
- 插入初始角色数据
- 插入初始分类和支付方式
- 创建默认管理员用户

#### 步骤3: 访问登录页面
```
http://localhost/public/index.php?r=auth/login
```

默认登录信息：
- 用户名: `admin`
- 密码: `admin123`

### 2. 命令行测试（如果PHP在PATH中）

#### 检查PHP版本
```bash
php -v
```

#### 检查PHP扩展
```bash
php -m | findstr "pdo mysql mbstring session"
```

#### 导入数据库（Windows）
```bash
mysql -u root -p coffee_finance < database\schema.sql
```

#### 导入数据库（Linux/Mac）
```bash
mysql -u root -p coffee_finance < database/schema.sql
```

### 3. 功能测试清单

登录后，按以下顺序测试功能：

#### ✅ 基础功能测试
- [ ] **登录功能**
  - 使用 admin/admin123 登录
  - 测试错误密码提示
  - 测试语言切换（中文/越南语）

- [ ] **Dashboard（总览）**
  - 查看今日收入/支出/净额
  - 查看本月统计
  - 查看7天趋势图表
  - 查看最近10笔流水

- [ ] **添加交易**
  - 添加一笔收入（选择收入类型、金额、分类、支付方式）
  - 添加一笔支出（选择支出类型、金额、分类、支付方式、供应商）
  - 验证数据保存成功

- [ ] **交易列表**
  - 查看所有交易记录
  - 测试筛选功能：
    - 按类型筛选（收入/支出）
    - 按分类筛选
    - 按支付方式筛选
    - 按日期范围筛选
    - 关键词搜索
  - 点击查看交易详情

- [ ] **交易详情**
  - 查看交易完整信息
  - 测试作废功能（需要老板/财务权限）

- [ ] **设置管理**（需要相应权限）
  - 分类管理：添加、编辑分类
  - 支付方式管理：添加、编辑支付方式
  - 供应商管理：添加、编辑供应商

#### ✅ 权限测试
- [ ] **员工权限**
  - 只能添加交易
  - 不能删除/作废交易
  - 不能访问设置页面

- [ ] **财务权限**
  - 可以添加交易
  - 可以作废交易
  - 可以访问设置页面

- [ ] **老板权限**
  - 所有权限

#### ✅ 多语言测试
- [ ] 切换中文，验证所有页面显示中文
- [ ] 切换越南语，验证所有页面显示越南语
- [ ] 验证语言选择在刷新后保持

### 4. 常见问题排查

#### 问题：测试页面显示数据库连接失败
**解决方案：**
1. 检查 MySQL 服务是否运行
2. 检查 `app/config/db.php` 中的配置
3. 确认数据库 `coffee_finance` 已创建：
   ```sql
   CREATE DATABASE coffee_finance DEFAULT CHARSET=utf8mb4;
   ```

#### 问题：表不存在
**解决方案：**
1. 访问 `http://localhost/init_db.php` 初始化数据库
2. 或手动执行：
   ```bash
   mysql -u root -p coffee_finance < database/schema.sql
   ```

#### 问题：无法登录
**解决方案：**
1. 确认数据库中有用户数据
2. 检查密码是否正确（默认：admin123）
3. 重置密码：
   ```sql
   UPDATE users SET password_hash = '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi' 
   WHERE username = 'admin';
   ```

#### 问题：页面404错误
**解决方案：**
1. 确认访问路径正确：`public/index.php?r=...`
2. 检查 `.htaccess` 文件是否存在
3. 确认 Apache `mod_rewrite` 已启用

### 5. 测试数据建议

为了充分测试系统，建议添加以下测试数据：

#### 添加测试交易
1. **收入交易**（5-10笔）
   - 不同分类（堂食、外卖、团购）
   - 不同支付方式（现金、转账、VNPAY）
   - 不同日期（今天、昨天、本周、本月）

2. **支出交易**（5-10笔）
   - 不同分类（食材、房租、工资）
   - 不同供应商
   - 不同支付方式

#### 验证统计功能
- 检查 Dashboard 中的统计数据是否正确
- 验证7天趋势图表数据
- 检查分类统计

### 6. 性能测试

- 测试大量数据（100+ 交易记录）的列表加载速度
- 测试筛选和搜索的响应速度
- 测试 Dashboard 统计计算的性能

## 测试报告模板

测试完成后，记录以下信息：

```
测试日期: ___________
测试人员: ___________
PHP版本: ___________
MySQL版本: ___________

功能测试结果:
- 登录功能: ✅/❌
- Dashboard: ✅/❌
- 添加交易: ✅/❌
- 交易列表: ✅/❌
- 筛选功能: ✅/❌
- 设置管理: ✅/❌
- 多语言: ✅/❌

发现的问题:
1. ___________
2. ___________

建议:
1. ___________
2. ___________
```

